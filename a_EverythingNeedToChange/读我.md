# Grafana_HGCDB_ä»ªè¡¨ç›˜ Îµ=Îµ=(<ã‚Ï‰ãƒ»)â˜†
ç”± [Grafana](https://github.com/grafana/grafana?tab=readme-ov-file) è‡ªåŠ¨ç”Ÿæˆçš„ä»ªè¡¨ç›˜ï¼Œç”¨ä»¥ç›‘æŽ§ HGCDB æ•°æ®åº“ã€‚

**å¼€å‘è€…**ï¼š  
-é™ˆæ€é›¨ï¼šæ•´ä½“ä»£ç ç»“æž„ï¼Œä»ªè¡¨ç›˜  
-åº„å¿ƒä¹ï¼šè­¦å‘Šç³»ç»Ÿ  
ä»¥åŠå…¨ä½“CMU MACæˆå‘˜çš„æ”¯æŒä¸Žå¸®åŠ©

**ä»ªè¡¨ç›˜å®žä¾‹ðŸ¦­**:   
[CMU ä»ªè¡¨ç›˜](https://cmuhgcdashboard.phys.cmu.edu:3000/dashboards)

# å¤§ç‰ˆæœ¬æ›´æ–°ï¼š
**é‡ç£…æŽ¨å‡ºï¼Œå…¨æ–°ä¸Šçº¿ï¼ç»„ä»¶ä¸€é”®æŸ¥è¯¢è¡¨å•**  
- è¿˜åœ¨ä¸ºæ‰¾ä¸åˆ°ç»„ä»¶è€Œçƒ¦æ¼å—ï¼Ÿ
- è¿˜åœ¨ä¸ºä»Žæ•°æ®åº“æŸ¥è¯¢ç»„ä»¶å‚æ•°è€Œçƒ¦èºå—ï¼Ÿ
- è¿˜åœ¨ä¸ºä¸çŸ¥é“å¦‚ä½•æ‰¾åˆ°ç»„ä»¶æ•°æ®è€Œå›°æ‰°å—ï¼Ÿ

**ã€Components Look-up Formã€‘â€”â€”ä¸ºæ¯ä¸€ä¸ªç»„ä»¶æ‰“é€ ä¸“å±žæ¡£æ¡ˆï¼**
- åªéœ€è¾“å…¥ä¸€ä¸ªç»„ä»¶åºåˆ—å·ï¼Œ
- æ— è®ºæ˜¯ Sensorã€Baseplateã€Hexaboardã€Proto è¿˜æ˜¯å®Œæ•´ Moduleï¼Œ
- **é€šé€šå¸®ä½ æŸ¥åˆ°åº• Â· çœ‹åˆ°åº•ï¼**

## ä¸è¦9 9 8ï¼Œä¸è¦9 8ï¼Œåªéœ€ `git pull` ä¸€æ¬¡ï¼å³å¯äº«å—ç”±ç¬”è€…æœ¬äººå€¾æƒ…æ‰“é€ çš„ è¶… ç» ä»ª è¡¨ ç›˜ ï¼

- è¿˜åœ¨ç­‰ä»€ä¹ˆï¼Ÿå¿«æ¥ä½“éªŒå§ï¼


## å‰ç½®æ­¥éª¤
1. ä¸‹è½½å¹¶å®‰è£… Grafana
- [Get Grafana](https://grafana.com/get)

è¯·åœ¨`Get Grafana`é¡µé¢ä¸­é€‰æ‹©`OSS`ï¼Œç„¶åŽæ ¹æ®æ‚¨æœåŠ¡å™¨çš„ç³»ç»Ÿé€‰æ‹©ä¸‹è½½æ¸ é“ã€‚ç¬”è€…æœ¬äººæ‰€ä½¿ç”¨çš„ Grafana ç‰ˆæœ¬ä¸º`v12.0.0`ã€‚

Grafana çš„é»˜è®¤ç«¯å£ä¸º`localhost:3000`ã€‚é»˜è®¤ URL ä¸º http://localhost:3000ã€‚ æ‚¨å¯ä»¥æ ¹æ®è‡ªå·±çš„å®žé™…æƒ…å†µè¿›è¡Œè°ƒæ•´ã€‚
- é»˜è®¤ Grafana ç”¨æˆ·åï¼š`admin`
- é»˜è®¤ Grafana å¯†ç ï¼š`admin`

2. æ£€æŸ¥å¹¶è¿è¡Œ `create_config.py` è„šæœ¬ã€‚
- è¯¥è„šæœ¬ä¼šç”Ÿæˆè¿žæŽ¥æ•°æ®åº“å’Œ Grafana çš„é…ç½®æ–‡ä»¶ã€‚
```
python create_config.py
```
- `db_conn.yaml` ä¸ºæ•°æ®åº“çš„é…ç½®æ–‡ä»¶ã€‚
- `gf_conn.yaml` ä¸º Grafana çš„é…ç½®æ–‡ä»¶ã€‚

3. å¯åŠ¨ Grafana æœåŠ¡å™¨ï¼š
```
sudo systemctl status grafana-server
```
- æ›´å¤šä¿¡æ¯ [Start Grafana](https://grafana.com/docs/grafana/latest/setup-grafana/start-restart-grafana/)

4. ä¿®æ”¹ Grafana é…ç½®æ–‡ä»¶ä»¥å…è®¸åŒ¿åè®¿é—®ï¼š
- Linux ç³»ç»Ÿçš„é…ç½®æ–‡ä»¶è·¯å¾„ä¸ºï¼š`/etc/grafana/grafana.ini`
- ä¿®æ”¹`auth.anonymous`é…ç½®é¡¹ï¼Œå°†`enabled`çš„å€¼è®¾ç½®ä¸º`true`ï¼š
```
[auth.anonymous]
enabled = true

# Organization name that should be used for unauthenticated users
org_name = Main Org.

# Role for unauthenticated users, other valid values are `Editor` and `Admin`
org_role = Viewer

# Hide the Grafana version text from the footer and help tooltip for unauthenticated users (default: false)
hide_version = true

# Setting this limits the number of anonymous devices in your instance. Any new anonymous devices added after the limit has been reached will be denied access.
device_limit =
```
- é‡å¯ Grafana æœåŠ¡å™¨ï¼š
```
sudo systemctl restart grafana-server
```
- æ›´å¤šä¿¡æ¯ [Grafana Anonymous Access](https://grafana.com/docs/grafana/latest/setup-grafana/configure-security/configure-authentication/anonymous-auth/)


## è¿è¡Œæ­¥éª¤
1. è¿è¡Œ`main.py`ï¼š
```
python main.py
```


# æ–‡ä»¶åŠæ–‡ä»¶å¤¹è¯´æ˜Žï¼š
- æ–‡ä»¶ï¼š
    - `main.py`ï¼šè¶…çº§æ— æ•Œè‡ªåŠ¨åŒ–æµç¨‹æ‰€éœ€è¿è¡Œçš„å”¯ä¸€è„šæœ¬ï¼å˜¿å˜¿ï¼
    - `create_config.py`ï¼šç”Ÿæˆæ•°æ®åº“è¿žæŽ¥é…ç½®æ–‡ä»¶`db_conn.yaml`å’Œ Grafana é…ç½®æ–‡ä»¶`gf_conn.yaml`ã€‚
- æ–‡ä»¶å¤¹ï¼š
    - `config_folders`ï¼šå­˜å‚¨æ‰€æœ‰ Grafana ä»ªè¡¨ç›˜çš„é…ç½®æ–‡ä»¶ã€‚
    - `create`ï¼šå­˜å‚¨æ‰€æœ‰ Grafana ä»ªè¡¨ç›˜çš„åˆ›å»ºè„šæœ¬ã€‚
    - `preSteps`ï¼šå­˜å‚¨æ‰€æœ‰ Grafana ä»ªè¡¨ç›˜çš„å‰ç½®æ­¥éª¤è„šæœ¬ã€‚
    - `tool`ï¼šå­˜å‚¨æ‰€æœ‰ç”¨ä»¥ç”Ÿæˆ Grafana ä»ªè¡¨ç›˜çš„å·¥å…·è„šæœ¬ã€‚


# è¿è¡Œæµç¨‹ï¼š
`preSteps`æ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰è„šæœ¬ä»…ä¼šè¿è¡Œä¸€æ¬¡ï¼Œç”±`gf_conn.yaml`æ–‡ä»¶ä¸­çš„`GF_RUN_TIMES`ç›‘ç®¡ï¼ˆè¯·åœ¨ç¬¬ä¸€æ¬¡è¿è¡Œä¸»è„šæœ¬å‰æ£€æŸ¥`gf_conn.yaml`æ–‡ä»¶ä¸­çš„é…ç½®ï¼Œç¡®ä¿`GF_RUN_TIMES`å€¼ä¸º0ï¼‰ã€‚
- `preSteps`æ–‡ä»¶å¤¹ï¼š
    - `get_api_key.py`ï¼šèŽ·å– Grafana åº”ç”¨ç¨‹åºç¼–ç¨‹æŽ¥å£å¯†é’¥ã€‚è¯¥å¯†é’¥ä¼šè¢«å­˜å‚¨äºŽ`gf_conn.yaml`ï¼Œç”¨ä»¥åŽç»­çš„æ·»åŠ æ•°æ®åº“ï¼Œåˆ›å»º Grafana æ–‡ä»¶å¤¹ï¼Œä»¥åŠä¸Šä¼ ä»ªè¡¨ç›˜ç­‰æ“ä½œã€‚
    - `add_datasource.py`ï¼šæ·»åŠ æ•°æ®åº“ã€‚è¯¥è„šæœ¬ä¼šè¯»å–`db_conn.yaml`æ–‡ä»¶ä¸­çš„æ•°æ®åº“è¿žæŽ¥ä¿¡æ¯ï¼Œå¹¶æ·»åŠ åˆ° Grafana çš„æ•°æ®æºä¸­ã€‚
    - æ›´å¤šå…³äºŽ [Grafana API](https://grafana.com/docs/grafana/latest/developers/http_api/) çš„ä¿¡æ¯ã€‚
- `create`æ–‡ä»¶å¤¹ï¼š
    - `create_alerts.py`ï¼šç”Ÿæˆå¹¶ä¸Šä¼ è­¦æŠ¥ï¼ˆï¼Ÿï¼‰ã€‚ç”Ÿæˆçš„jsonæ–‡ä»¶å°†è¢«å­˜å‚¨åœ¨`Alerts`æ–‡ä»¶å¤¹ä¸­ã€‚
    - `create_dashboards.py`ï¼šç”Ÿæˆå¹¶ä¸Šä¼ ä»ªè¡¨ç›˜ã€‚ç”Ÿæˆçš„jsonæ–‡ä»¶å°†è¢«å­˜å‚¨åœ¨`Dashboards`æ–‡ä»¶å¤¹ä¸­ã€‚
    - `create_folders.py`ï¼šåˆ›å»º Grafana æ–‡ä»¶å¤¹ã€‚
- `tool`æ–‡ä»¶å¤¹ï¼š
    - `dashboard_builder.py`ï¼šç”Ÿæˆ Grafana ä»ªè¡¨ç›˜çš„å·¥å…·è„šæœ¬ã€‚
    - `helper.py`ï¼šè¾…åŠ©è„šæœ¬ï¼ŒåŒ…å«è¾…åŠ©ç±»ï¼Œå¦‚ï¼šè¯»å–é…ç½®æ–‡ä»¶ï¼Œåˆ›å»º Grafana ç”¨æˆ·ï¼›è¾…åŠ©å‡½æ•°ï¼Œå¦‚ï¼š`create_uid`ï¼Œä»¥åŠå…¨å±€å˜é‡ã€‚
    - `other_builder.py`ï¼š Grafana å…¶ä»–ç»„ä»¶çš„ç”Ÿæˆè„šæœ¬ï¼Œæ¯”å¦‚ï¼šç­›é€‰å™¨ï¼Œè­¦æŠ¥ã€‚
    - `panel_builder.py`ï¼šç”Ÿæˆ Grafana ä»ªè¡¨ç›˜çš„é¢æ¿è„šæœ¬ï¼Œé¢æ¿æœ‰ä¸¤ç§ï¼šé€šç”¨SQLé¢æ¿å’ŒIVæ›²çº¿å›¾.
    - `sql_builder.py`ï¼šç”Ÿæˆ Grafana ä»ªè¡¨ç›˜çš„ SQL æŸ¥è¯¢è„šæœ¬ã€‚åœ¨è¯¥æ–‡ä»¶ä¸­ï¼Œç¬”è€…ä½¿ç”¨äº†æŠ½è±¡ç±»ï¼ˆABCï¼‰ä»¥åŠå·¥åŽ‚æ¨¡å¼è‡ªå®šä¹‰é¢æ¿ç±»åž‹æŽ¥å£ï¼Œæ–¹ä¾¿åŽç»­å¼€å‘è€…å¼€å‘ã€‚è¯¥ç±»ä»…åœ¨`panel_builder.py`ä¸­ç¬¬31-40è¡Œä¸­è¢«è°ƒç”¨ï¼Œä¸ºé¢æ¿ç”Ÿæˆ SQL æŸ¥è¯¢è¯­å¥ã€‚
    - æ›´å¤šå…³äºŽ Grafana ä»ªè¡¨ç›˜çš„ [JSON MODEL](https://grafana.com/docs/grafana/latest/dashboards/build-dashboards/view-dashboard-json-model/)
  
æ„Ÿè°¢é˜…è¯»å’Œä½¿ç”¨ï¼æ¬¢è¿Žæå‡ºå®è´µæ„è§ï¼